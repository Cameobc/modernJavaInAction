# 병렬 데이터 처리와 성능

 - 별렬화를 수행하면서 에러를 최소화할 수 있도록 JAVA 7은 포크/조인 프레임워크를 제공함

### 1. 병렬 스트림
 - paralleStream 을 호출 시 생성
 - 각각의 스레드에서 처리할 수 있도록 스트림 요소를 여러 청크로 분할함
 - 이를 이용 시 모든 멀티코어 프로세서가 각각의 청크를 처리하도록 할당 가능 
 - 1.1. 순차 스트림을 병렬 스트림으로 변환
   - parallel() 호출 시 이후 연산이 병렬로 수행되어야 함을 의미하는 불리언 플래그가 설정
   - sequential() 로 병렬을 순차 스트림으로 바꿀 수 있음
 - 1.2. 스트림 성능 측정
   - JMH 라이브러리를 이용해 작은 벤치마크를 구현
   - 이를 이용하면 간단하고, 어노테이션 기반 방식 지원하며 안정적으로 자바 프로그램이나 JVM을 대상으로 하는 다른 언어용 ㅔㄴ치마크를 구현할 수 있음
     - 반복 결과로 박싱된 객체가 만들어지므로 숫자를 더하려면 언박싱을 해야 함
     - 반복 작업은 병렬로 수행할 수 있는 독립 단위로 나누기가 어려움
   -  
 - 1.3. 병렬 스트림의 올바른 사용법
   - 잘못 사용하며 나타나는 문제는 공유된 상태를 바꾸는 알고리즘을 사용하기 때문에 일어남
   - 공유된 가변 상태를 피해야 함
 - 1.4. 병렬 스트림 효과적으로 사용하기
   - 확신이 서지 않으면 직접 측정
   - 박싱을 주의
   - 순차 스트림보다 병렬 스트림에서 성능이 떨어지는 연산이 있음
   - 스트림에서 수행하는 전체 파이프라인 연산 비용을 고려
   - 소량의 데이터에서는 병렬 스트림이 도움이 되지 않음
   - 스트림을 구현하는 자료 구조가 적절한지 확인 필요
   - 스트림의 특성과  파이프라인의 중간 연산이 스트림의 특성을 어떻게 바꾸는지에 따라 분해 과정의 성능이 달라질 수 있음
   - 최종 연산의 병합 과정을 살펴봐야 함

### 2. 포크/조인 프레임워크
 - 2-1.Recursive Task 활용
   - 병렬화 된 태스크가 생성하는 결과 형식/ 결과는 없을 때는 RecursiveAction 형식
 - 2-2. 포크/조인 프레임워크를 제대로 사용하는 방법
   - join 메소드를 태스크에 호출하면 태스크가 생상하는 결과가 준비될 때까지 호출자를 블록시킴 
   - RecursiveTask 내에서는 compute 나 fork 메서드를 직접 호출하고 계산을 시작할 때만 invoke 사용
   - fork 메서드를 호출해서 ForkJoinPool 일정 조절 가능
   - 
 - 2.3. 작업 훔치키
   - 포크/조인 프레임워크에서 문제를 해결하는 기법
   - 이를 통해 ForkJoinPool 의 모든 스레드를 거의 공정하게 분할
   - 각각의 스테르드는 자신에게 할당된 태스크를 포함하는 이중 연결 리스트를 참조하면서 작업이 끝날 때마다 큐의 헤드에서 다른 태스크를 가져와서 작업함
   - 즉, 일을 마친 스레드는 다른 스테르 큐의 꼬리에서 작업을 훔쳐옴
   - 이로 인해 작업자 스레드 간의 작업부하를 비슷한 수준으로 유지할 수 있음

### 3. Spliterator 인터페이스
 - 병렬 작업에 특화
 - 어떻게 동작하는지 이해한다면 병렬 스트림 동작과 관련한 통찰력을 얻을 수 있음
 - 3.1. 분할 과정
   - null 을 반환할 때까지 재귀 분할하고 null 이 반환되면 재귀 분할 과정이 종료
 - 탐색하려는 데이터를 포함하는 스트림을 어떻게 병렬화할 것인지를 정의